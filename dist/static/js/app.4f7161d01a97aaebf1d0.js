webpackJsonp([1],{"1x3T":function(e,t){},"8Suv":function(e,t){},"9UZg":function(e,t){},JFkA:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("7+uW"),a=s("C/JF"),n=s("fhbW"),r=s("1e6/"),o=s("Dd8w"),u=s.n(o),d=s("NYxO"),c=s("gRE1"),l=s.n(c);window.firebase.initializeApp({apiKey:"AIzaSyDeQSrnOySw3Ws-PT1Isq_8-FeIS2B-PZw",authDomain:"vue-chat-room-11def.firebaseapp.com",databaseURL:"https://vue-chat-room-11def.firebaseio.com",projectId:"vue-chat-room-11def",storageBucket:"vue-chat-room-11def.appspot.com",messagingSenderId:"249927196895"});var m=window.firebase.database(),g=function(e){return m.ref(e)},p={name:"Messages",computed:u()({},Object(d.d)({messageIdForEditMode:function(e){return e.messageForm.id},currentUserId:function(e){return e.auth.id},messagesMap:function(e){return e.dialogs.messages},messagesList:function(e){return l()(e.dialogs.messages).filter(function(e){return e})},selectedDialog:function(e){return e.dialogs.selectedDialog}})),methods:u()({},Object(d.c)("messageForm",["updateFormData","resetFormData"]),{deleteMessage:function(e){var t=e.id;g("dialogs/"+this.selectedDialog+"/messages").child(t).remove()},openEditMessageMode:function(e){var t=e.id;this.updateFormData({text:this.messagesMap[t].text,id:t}),document.getElementById("message-form-input").focus()},cancelEditMessageMode:function(){this.resetFormData()}})},h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messages",attrs:{id:"messages"}},[e.messagesList.length?e._l(e.messagesList,function(t){return s("div",{key:t.timestamp,staticClass:"message",class:{isReply:t.userId!==e.currentUserId,isSender:t.userId===e.currentUserId}},[s("div",{staticClass:"message__content"},[t.userId!==e.currentUserId?s("span",{staticClass:"message__icon"},[e._v(e._s(t.userName.charAt(0)))]):e._e(),e._v(" "),s("div",{staticClass:"message__text",class:{edit:t.id===e.messageIdForEditMode}},[s("span",[e._v("\n          "+e._s(t.text.trim())+"\n        ")]),e._v(" "),t.userId===e.currentUserId?s("div",{staticClass:"message__text-icons"},[t.id!==e.messageIdForEditMode?s("div",[s("font-awesome-icon",{staticClass:"message__text-icon",attrs:{icon:"edit"},on:{click:function(s){return s.preventDefault(),e.openEditMessageMode({id:t.id})}}}),e._v(" "),s("font-awesome-icon",{staticClass:"message__text-icon",attrs:{icon:"times-circle"},on:{click:function(s){return s.preventDefault(),e.deleteMessage({id:t.id})}}})],1):s("div",[s("font-awesome-icon",{staticClass:"message__text-icon",attrs:{icon:"undo"},on:{click:function(s){return s.preventDefault(),e.cancelEditMessageMode({id:t.id})}}})],1)]):e._e()])])])}):s("div",{staticClass:"messages__loader d-flex justify-content-center"},[e._m(0)])],2)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"spinner-border",attrs:{role:"status"}},[t("span",{staticClass:"sr-only"},[this._v("Loading...")])])}]};var f=s("VU/8")(p,h,!1,function(e){s("1x3T")},"data-v-1783cb8c",null).exports,v=s("Gu7T"),_=s.n(v),U=s("fZjL"),y=s.n(U),w={name:"NewMessage",computed:u()({},Object(d.d)({id:function(e){return e.messageForm.id},userName:function(e){return e.auth.name},userId:function(e){return e.auth.id},typingUsers:function(e){return e.dialogs.typingUsers},users:function(e){return e.users.usersMap},dialogsDBPath:function(e){return"dialogs/"+e.dialogs.selectedDialog+"/messages"}}),{namesOfTypingUsers:function(){var e=this;return y()(this.typingUsers).reduce(function(t,s){return e.typingUsers[s]&&s!==e.userId?[].concat(_()(t),[e.users[s].name]):t},[])},text:{get:function(){return this.$store.state.messageForm.text},set:function(e){e&&!this.typingUsers[this.userId]&&this.saveTypingUser({userId:this.userId,isTyping:!0}),e||this.saveTypingUser({userId:this.userId,isTyping:!1}),this.updateFormData({text:e,id:this.id})}}}),methods:u()({},Object(d.c)("messageForm",["updateFormData","resetFormData"]),Object(d.b)("dialogs",["saveTypingUser"]),{saveNewMessage:function(){var e=this;g(this.dialogsDBPath).push({userName:this.userName,userId:this.userId,text:this.text,timestamp:Date.now()},function(t){if(t)throw new Error("Can not send the message");e.resetFormData()})},updateMessage:function(){var e=this;g(this.dialogsDBPath).child(this.id).update({text:this.text,updatedAt:Date.now()},function(t){if(t)throw new Error("Can not update the message");e.resetFormData()})},handleInputKeypress:function(e){"Enter"===e.key&&this.handleFormSubmit()},handleFormSubmit:function(){this.saveTypingUser({userId:this.userId,isTyping:!1}),this.id?this.updateMessage():this.saveNewMessage()}})},b={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"new-message"},[s("form",{on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit(t)}}},[s("div",{staticClass:"form-group new-message-form"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],staticClass:"form-control",attrs:{id:"message-form-input",placeholder:"Your message",rows:"3"},domProps:{value:e.text},on:{keypress:e.handleInputKeypress,input:function(t){t.target.composing||(e.text=t.target.value)}}}),e._v(" "),s("div",{staticClass:"typing-info"},e._l(e.namesOfTypingUsers,function(t){return s("i",{key:t},[e._v("\n          "+e._s(t)+" is typing...\n        ")])}),0)]),e._v(" "),s("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[e._v(e._s(e.id?"Update":"Send New")+" Message")])])])},staticRenderFns:[]};var I=s("VU/8")(w,b,!1,function(e){s("pVm1")},"data-v-41642670",null).exports,D={signUp:"Sign Up",signIn:"Sign In"},C={name:"AuthForm",data:function(){return{authMode:D,email:"",password:"",name:"",mode:D.signIn}},computed:u()({},Object(d.d)({isAuthorizing:function(e){return e.auth.isAuthorizing}})),methods:u()({},Object(d.b)("auth",["signUpWithEmail","signInWithEmail"]),Object(d.c)("auth",["setIsAuthorizing"]),{setMode:function(e){this.mode=e},signIn:function(){this.signInWithEmail({email:this.email,password:this.password})},signUp:function(){this.signUpWithEmail({email:this.email,password:this.password,name:this.name})},handleFormSubmit:function(){this.setIsAuthorizing(!0),this.mode===D.signIn?this.signIn():this.signUp()}})},M={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("form",{on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit(t)}}},[e.mode===e.authMode.signUp?s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"user-name"}},[e._v("Name")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form-control",attrs:{type:"text",id:"user-name",placeholder:"Name"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]):e._e(),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"user-email"}},[e._v("Email address")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form-control",attrs:{type:"email",id:"user-email",placeholder:"Enter email"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}})]),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"user-password"}},[e._v("Password")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-control",attrs:{type:"password",id:"user-password",placeholder:"Password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e._v(" "),s("button",{staticClass:"btn btn-primary",attrs:{type:"submit",disabled:e.isAuthorizing}},[e.isAuthorizing?s("span",[s("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}),e._v("\n        Authorizing...\n      ")]):s("span",[e._v("\n        "+e._s(e.mode)+"\n      ")])])]),e._v(" "),s("div",{staticClass:"dropdown-divider"}),e._v(" "),e.mode===e.authMode.signIn?s("div",[s("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.setMode(e.authMode.signUp)}}},[e._v("New around here? Sign up")]),e._v(" "),s("a",{staticClass:"dropdown-item",attrs:{href:"#"}},[e._v("Forgot password?")])]):s("div",[s("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.setMode(e.authMode.signIn)}}},[e._v("Already have account? Sign in")])])])},staticRenderFns:[]};var x=s("VU/8")(C,M,!1,function(e){s("9UZg")},"data-v-6c06818e",null).exports,F={name:"UserHeader",computed:u()({},Object(d.d)({userName:function(e){return e.auth.name}})),methods:u()({},Object(d.b)("auth",["signOut"]),{initSignOut:function(){this.signOut()}})},A={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"user-header"},[t("h2",{staticClass:"user-header__text"},[this._v("Hello, "+this._s(this.userName)+"!")]),this._v(" "),t("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:this.initSignOut}},[this._v("Sign Out")])])},staticRenderFns:[]};var E=s("VU/8")(F,A,!1,function(e){s("JFkA")},"data-v-1ea91767",null).exports,k=this,N={name:"Users",data:function(){return{isUsersListVisible:!1}},computed:u()({},Object(d.d)({currentUserId:function(e){return e.auth.id},usersList:function(e){return l()(e.users.usersMap).filter(function(e){return e.id!==k.currentUserId})}})),methods:u()({},Object(d.c)("users",["saveNewUserInStore"]),Object(d.b)("dialogs",["loadDialogMessages"]),{toggleUsersList:function(){this.isUsersListVisible=!this.isUsersListVisible},openDialogWithUser:function(e){var t,s=e.id;this.toggleUsersList(),this.loadDialogMessages({selectedDialog:(t={currentUserId:this.currentUserId,otherUserId:s},[t.currentUserId,t.otherUserId].sort().join("-"))})}}),created:function(){var e=this;g("users").on("child_added",function(t){t.key!==e.currentUserId&&e.saveNewUserInStore({user:t.val()})})}},S={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"users"},[s("div",{staticClass:"btn-group"},[s("button",{staticClass:"btn btn-secondary btn-lg dropdown-toggle",attrs:{type:"button"},on:{click:e.toggleUsersList}},[e._v("\n      Users list\n    ")]),e._v(" "),e.isUsersListVisible?s("div",{staticClass:"dropdown-menu visible"},[s("ul",{staticClass:"users-list"},e._l(e.usersList,function(t){return s("li",{key:t.id,staticClass:"user-item",on:{click:function(s){return e.openDialogWithUser({id:t.id})}}},[e._v("\n          "+e._s(t.name)+"\n        ")])}),0)]):e._e()])])},staticRenderFns:[]};var O={name:"App",components:{UserHeader:E,Messages:f,NewMessage:I,AuthForm:x,Users:s("VU/8")(N,S,!1,function(e){s("rixm")},"data-v-7f98718f",null).exports},data:function(){return{isAuthLoaded:!1}},computed:u()({},Object(d.d)({userId:function(e){return e.auth.id},isAuthorizing:function(e){return e.auth.isAuthorizing},selectedDialog:function(e){return e.dialogs.selectedDialog}})),methods:u()({},Object(d.c)("auth",["setUserData","resetUserData"])),created:function(){var e=this;window.firebase.auth().onAuthStateChanged(function(t){if(e.isAuthLoaded||(e.isAuthLoaded=!0),t){if(!e.userId&&!e.isAuthorizing){var s=t.providerData,i=t.uid,a=s[0],n=a.displayName,r=a.photoURL,o=a.email;e.setUserData({name:n,image:r,email:o,id:i,updateProfile:t.updateProfile.bind(t)})}}else e.userId&&e.resetUserData()})}},P={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[e.isAuthLoaded?s("div",{staticClass:"app-container"},[s("div",{staticClass:"app-header"},[e.userId?s("Users"):e._e(),e._v(" "),s("div",{staticClass:"main-icon"})],1),e._v(" "),e.userId?s("div",[s("UserHeader"),e._v(" "),e.selectedDialog?s("div",[s("Messages"),e._v(" "),s("NewMessage")],1):s("h3",[e._v("Please select a user to start a dialog with")])],1):s("AuthForm")],1):s("div",{staticClass:"page-loader-wrapper"},[e._m(0)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"spinner-grow",staticStyle:{width:"5rem",height:"5rem"},attrs:{role:"status"}},[t("span",{staticClass:"sr-only"},[this._v("Loading...")])])}]};var T=s("VU/8")(O,P,!1,function(e){s("8Suv")},null,null).exports;i.a.use(d.a);var L={id:"",name:"",image:"",email:"",updateProfile:void 0,isAuthorizing:!1},j={setIsAuthorizing:function(e,t){e.isAuthorizing=t},setUserData:function(e,t){var s=t.id,i=t.name,a=t.image,n=t.email,r=t.updateProfile;e.id=s,e.name=i,e.image=a,e.email=n,e.updateProfile=r},resetUserData:function(){L.id="",L.name="",L.image="",L.email="",L.updateProfile=void 0}},z=function(e){var t=e.context,s=e.user,i=e.name,a=s.providerData;t.commit("setUserData",{name:i||a[0].displayName,image:a[0].photoURL,email:a[0].email,id:s.uid,updateProfile:s.updateProfile.bind(s)})},W={namespaced:!0,state:L,mutations:j,actions:{signUpWithEmail:function(e,t){var s=t.email,i=t.password,a=t.name;window.firebase.auth().createUserWithEmailAndPassword(s,i).then(function(e){var t=e.user;return t.updateProfile({displayName:a}).then(function(){return t})}).then(function(e){return g("users/"+e.uid).set({name:a,id:e.uid}).then(function(t){return{responseFromAddNewUser:t,user:e}})}).then(function(t){var s=t.user;z({context:e,user:s,name:a})}).catch(function(e){console.log("sign up error",e)}).finally(function(){e.commit("setIsAuthorizing",!1)})},signInWithEmail:function(e,t){var s=t.email,i=t.password;window.firebase.auth().signInWithEmailAndPassword(s,i).then(function(t){var s=t.user;z({context:e,user:s})}).catch(function(e){console.log("sign in error",e)}).finally(function(){e.commit("setIsAuthorizing",!1)})},signOut:function(e){window.firebase.auth().signOut().then(function(){e.commit("resetUserData")}).catch(function(e){console.log("error",e)})}}};i.a.use(d.a);var V={namespaced:!0,state:{text:"",id:void 0},mutations:{updateFormData:function(e,t){var s=t.text,i=t.id;e.text=s,e.id=i},resetFormData:function(e){e.text="",e.id=""}}},R=s("bOdI"),$=s.n(R);i.a.use(d.a);var B={namespaced:!0,state:{selectedDialog:"",messages:{},typingUsers:{}},mutations:{updateSelectedDialog:function(e,t){var s=t.selectedDialog;e.selectedDialog=s},updateMessage:function(e,t){var s=t.message;e.messages=u()({},e.messages,$()({},s.key,s.val))},updateTypingUser:function(e,t){var s=t.userId,i=t.isTyping;e.typingUsers=u()({},e.typingUsers,$()({},s,i))}},actions:{loadDialogMessages:function(e,t){var s=t.selectedDialog;e.commit("updateSelectedDialog",{selectedDialog:s});var i="dialogs/"+s+"/messages";g(i).on("child_added",function(t){e.commit("updateMessage",{message:{key:t.key,val:u()({},t.val(),{id:t.key})}}),setTimeout(function(){var e=document.getElementById("messages");e.scrollTop=e.scrollHeight},100)}),g(i).on("child_changed",function(t){e.commit("updateMessage",{message:{key:t.key,val:u()({},t.val(),{id:t.key})}})}),g(i).on("child_removed",function(t){e.commit("updateMessage",{message:{key:t.key,val:null}})}),g("dialogs/"+s+"/typingUsers").on("child_added",function(t){e.commit("updateTypingUser",{userId:t.key,isTyping:t.val()})}),g("dialogs/"+s+"/typingUsers").on("child_changed",function(t){e.commit("updateTypingUser",{userId:t.key,isTyping:t.val()})})},saveTypingUser:function(e,t){var s=t.userId,i=t.isTyping;g("dialogs/"+e.state.selectedDialog+"/typingUsers").update($()({},s,i))}}};i.a.use(d.a);var H={namespaced:!0,state:{usersMap:{}},mutations:{saveNewUserInStore:function(e,t){var s=t.user;e.usersMap=u()({},e.usersMap,$()({},s.id,s))}}};i.a.use(d.a);var J=new d.a.Store({modules:{auth:W,messageForm:V,dialogs:B,users:H}});a.c.add(n.a),a.c.add(n.c),a.c.add(n.d),a.c.add(n.b),i.a.component("font-awesome-icon",r.a),i.a.config.productionTip=!1,new i.a({el:"#app",components:{App:T},template:"<App/>",store:J})},pVm1:function(e,t){},rixm:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.4f7161d01a97aaebf1d0.js.map