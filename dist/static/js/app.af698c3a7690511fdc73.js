webpackJsonp([1],{"3Tng":function(e,t){},"5ToG":function(e,t){},"8ZzY":function(e,t){},ILwc:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("7+uW"),i=s("C/JF"),n=s("fhbW"),r=s("1e6/"),o=s("Dd8w"),d=s.n(o),u=s("NYxO"),c=s("gRE1"),l=s.n(c);window.firebase.initializeApp({apiKey:"AIzaSyDeQSrnOySw3Ws-PT1Isq_8-FeIS2B-PZw",authDomain:"vue-chat-room-11def.firebaseapp.com",databaseURL:"https://vue-chat-room-11def.firebaseio.com",projectId:"vue-chat-room-11def",storageBucket:"vue-chat-room-11def.appspot.com",messagingSenderId:"249927196895"});var m=window.firebase.database(),g=function(e){return m.ref(e)},p={name:"Messages",computed:d()({},Object(u.d)({messageIdForEditMode:function(e){return e.messageForm.id},currentUserId:function(e){return e.auth.id},messagesMap:function(e){return e.dialogs.messages},messagesList:function(e){return l()(e.dialogs.messages).filter(function(e){return e})},selectedDialog:function(e){return e.dialogs.selectedDialog},areDialogsLoaded:function(e){return e.dialogs.areLoaded}})),methods:d()({},Object(u.c)("messageForm",["updateFormData","resetFormData"]),{deleteMessage:function(e){var t=e.id;g("dialogs/"+this.selectedDialog+"/messages").child(t).remove()},openEditMessageMode:function(e){var t=e.id;this.updateFormData({text:this.messagesMap[t].text,id:t}),document.getElementById("message-form-input").focus()},cancelEditMessageMode:function(){this.resetFormData()}})},f={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"messages",attrs:{id:"messages"}},[e.areDialogsLoaded?e._l(e.messagesList,function(t){return s("div",{key:t.timestamp,staticClass:"message",class:{isReply:t.userId!==e.currentUserId,isSender:t.userId===e.currentUserId}},[s("div",{staticClass:"message__content"},[t.userId!==e.currentUserId?s("span",{staticClass:"message__icon"},[e._v(e._s(t.userName.charAt(0)))]):e._e(),e._v(" "),s("div",{staticClass:"message__text",class:{edit:t.id===e.messageIdForEditMode}},[s("span",[e._v("\n          "+e._s(t.text.trim())+"\n        ")]),e._v(" "),t.userId===e.currentUserId?s("div",{staticClass:"message__text-icons"},[t.id!==e.messageIdForEditMode?s("div",[s("font-awesome-icon",{staticClass:"message__text-icon",attrs:{icon:"edit"},on:{click:function(s){return s.preventDefault(),e.openEditMessageMode({id:t.id})}}}),e._v(" "),s("font-awesome-icon",{staticClass:"message__text-icon",attrs:{icon:"times-circle"},on:{click:function(s){return s.preventDefault(),e.deleteMessage({id:t.id})}}})],1):s("div",[s("font-awesome-icon",{staticClass:"message__text-icon",attrs:{icon:"undo"},on:{click:function(s){return s.preventDefault(),e.cancelEditMessageMode({id:t.id})}}})],1)]):e._e()])])])}):s("div",{staticClass:"messages__loader d-flex justify-content-center"},[e._m(0)])],2)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"spinner-border",attrs:{role:"status"}},[t("span",{staticClass:"sr-only"},[this._v("Loading...")])])}]};var h=s("VU/8")(p,f,!1,function(e){s("p5E+")},"data-v-8e96e3f0",null).exports,v=s("Gu7T"),_=s.n(v),y=s("fZjL"),b=s.n(y),U={name:"NewMessage",data:function(){return{currentUserIsTyping:!1}},computed:d()({},Object(u.d)({id:function(e){return e.messageForm.id},messageText:function(e){return e.messageForm.text},userName:function(e){return e.auth.name},userId:function(e){return e.auth.id},typingUsers:function(e){return e.dialogs.typingUsers},users:function(e){return e.users.usersMap},dialogsDBPath:function(e){return"dialogs/"+e.dialogs.selectedDialog+"/messages"}}),{namesOfTypingUsers:function(){var e=this;return b()(this.typingUsers).reduce(function(t,s){return e.typingUsers[s]&&s!==e.userId?[].concat(_()(t),[e.users[s].name]):t},[])}}),methods:d()({},Object(u.c)("messageForm",["updateFormData","resetFormData"]),Object(u.b)("dialogs",["saveTypingUser"]),{afterSuccessSubmit:function(){this.resetFormData()},handleInputChange:function(e){var t=e.target.value;this.updateFormData({text:t,id:this.id});var s=!1;!this.currentUserIsTyping&&t?(s=!0,this.currentUserIsTyping=!0):t||(s=!0,this.currentUserIsTyping=!1),s&&this.saveTypingUser({userId:this.userId,isTyping:this.currentUserIsTyping})},saveNewMessage:function(){var e=this;g(this.dialogsDBPath).push({userName:this.userName,userId:this.userId,text:this.messageText,timestamp:Date.now()},function(t){if(t)throw new Error("Can not send the message");e.afterSuccessSubmit()})},updateMessage:function(){var e=this;g(this.dialogsDBPath).child(this.id).update({text:this.messageText,updatedAt:Date.now()},function(t){if(t)throw new Error("Can not update the message");e.afterSuccessSubmit()})},handleFormSubmit:function(){this.saveTypingUser({userId:this.userId,isTyping:!1}),this.id?this.updateMessage():this.saveNewMessage()}})},w={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"new-message"},[s("form",{on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit(t)}}},[s("div",{staticClass:"form-group new-message-form"},[s("textarea",{staticClass:"form-control",attrs:{id:"message-form-input",placeholder:"Your message",rows:"3"},domProps:{value:e.messageText},on:{keypress:function(t){return t.type.indexOf("key")||13===t.keyCode?e.handleFormSubmit(t):null},input:e.handleInputChange}}),e._v(" "),s("div",{staticClass:"typing-info"},e._l(e.namesOfTypingUsers,function(t){return s("i",{key:t},[e._v("\n          "+e._s(t)+" is typing...\n        ")])}),0)]),e._v(" "),s("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[e._v(e._s(e.id?"Update":"Send New")+" Message")])])])},staticRenderFns:[]};var I=s("VU/8")(U,w,!1,function(e){s("3Tng")},"data-v-7bb2a10e",null).exports,D={signUp:"Sign Up",signIn:"Sign In"},C={name:"AuthForm",data:function(){return{authMode:D,email:"",password:"",name:"",mode:D.signIn}},computed:d()({},Object(u.d)({isAuthorizing:function(e){return e.auth.isAuthorizing},error:function(e){return e.auth.error}})),watch:{name:function(){this.resetError()},email:function(){this.resetError()},password:function(){this.resetError()}},methods:d()({},Object(u.b)("auth",["signUpWithEmail","signInWithEmail"]),Object(u.c)("auth",["setIsAuthorizing","resetError"]),{setMode:function(e){this.resetError(),this.mode=e},signIn:function(){this.signInWithEmail({email:this.email,password:this.password})},signUp:function(){this.signUpWithEmail({email:this.email,password:this.password,name:this.name})},handleFormSubmit:function(){this.setIsAuthorizing(!0),this.mode===D.signIn?this.signIn():this.signUp()}})},M={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("form",{staticClass:"auth-form",on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit(t)}}},[e.mode===e.authMode.signUp?s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"user-name"}},[e._v("Name")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form-control",attrs:{type:"text",id:"user-name",placeholder:"Name"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]):e._e(),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"user-email"}},[e._v("Email address")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form-control",attrs:{type:"email",id:"user-email",placeholder:"Enter email"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}})]),e._v(" "),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"user-password"}},[e._v("Password")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-control",attrs:{type:"password",id:"user-password",placeholder:"Password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e._v(" "),s("button",{staticClass:"btn btn-primary",attrs:{type:"submit",disabled:e.isAuthorizing}},[e.isAuthorizing?s("span",[s("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}),e._v("\n        Authorizing...\n      ")]):s("span",[e._v("\n        "+e._s(e.mode)+"\n      ")])])]),e._v(" "),s("div",{staticClass:"dropdown-divider"}),e._v(" "),e.mode===e.authMode.signIn?s("div",[s("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.setMode(e.authMode.signUp)}}},[e._v("New around here? Sign up")])]):s("div",[s("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.setMode(e.authMode.signIn)}}},[e._v("Already have account? Sign in")])]),e._v(" "),e.error?s("div",{staticClass:"auth-error"},[e._v("\n    "+e._s(e.error)+"\n  ")]):e._e()])},staticRenderFns:[]};var E=s("VU/8")(C,M,!1,function(e){s("8ZzY")},"data-v-7971d002",null).exports,L={name:"UserHeader",computed:d()({},Object(u.d)({userName:function(e){return e.auth.name}})),methods:d()({},Object(u.b)("auth",["signOut"]),Object(u.b)("dialogs",["resetDialogs"]),{initLogOut:function(){this.signOut(),this.resetDialogs()}})},x={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"user-header"},[t("h2",{staticClass:"user-header__text"},[this._v("Hello, "+this._s(this.userName)+"!")]),this._v(" "),t("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:this.initLogOut}},[this._v("Log Out")])])},staticRenderFns:[]};var F=s("VU/8")(L,x,!1,function(e){s("5ToG")},"data-v-ee8c4d24",null).exports,S={name:"Users",data:function(){return{isUsersListVisible:!1}},computed:d()({},Object(u.d)({currentUserId:function(e){return e.auth.id},usersList:function(e){return l()(e.users.usersMap).filter(function(t){return t.id!==e.auth.id})}})),methods:d()({},Object(u.c)("users",["saveNewUserInStore"]),Object(u.b)("dialogs",["loadDialogMessages"]),{toggleUsersList:function(){this.isUsersListVisible=!this.isUsersListVisible},openDialogWithUser:function(e){var t,s=e.id;this.toggleUsersList(),this.loadDialogMessages({selectedDialog:(t={currentUserId:this.currentUserId,otherUserId:s},[t.currentUserId,t.otherUserId].sort().join("-"))})}}),created:function(){var e=this;g("users").on("child_added",function(t){t.key!==e.currentUserId&&e.saveNewUserInStore({user:t.val()})})}},T={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"users"},[s("div",{staticClass:"btn-group"},[s("button",{staticClass:"btn btn-secondary btn-lg dropdown-toggle",attrs:{type:"button"},on:{click:e.toggleUsersList}},[e._v("\n      Users list\n    ")]),e._v(" "),e.isUsersListVisible?s("div",{staticClass:"dropdown-menu visible"},[s("ul",{staticClass:"users-list"},e._l(e.usersList,function(t){return s("li",{key:t.id,staticClass:"user-item",on:{click:function(s){return e.openDialogWithUser({id:t.id})}}},[e._v("\n          "+e._s(t.name)+"\n        ")])}),0)]):e._e()])])},staticRenderFns:[]};var A={name:"App",components:{UserHeader:F,Messages:h,NewMessage:I,AuthForm:E,Users:s("VU/8")(S,T,!1,function(e){s("ILwc")},"data-v-5e213b3c",null).exports},data:function(){return{isAuthLoaded:!1}},computed:d()({},Object(u.d)({userId:function(e){return e.auth.id},isAuthorizing:function(e){return e.auth.isAuthorizing},selectedDialog:function(e){return e.dialogs.selectedDialog}})),methods:d()({},Object(u.c)("auth",["setUserData","resetUserData"])),created:function(){var e=this;window.firebase.auth().onAuthStateChanged(function(t){if(e.isAuthLoaded||(e.isAuthLoaded=!0),t){if(!e.userId&&!e.isAuthorizing){var s=t.providerData,a=t.uid,i=s[0],n=i.displayName,r=i.photoURL,o=i.email;e.setUserData({name:n,image:r,email:o,id:a,updateProfile:t.updateProfile.bind(t)})}}else e.userId&&e.resetUserData()})}},k={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[e.isAuthLoaded?s("div",{staticClass:"app-container"},[s("div",{staticClass:"app-header"},[e.userId?s("Users"):e._e(),e._v(" "),s("div",{staticClass:"main-icon"})],1),e._v(" "),e.userId?s("div",[s("UserHeader"),e._v(" "),e.selectedDialog?s("div",[s("Messages"),e._v(" "),s("NewMessage")],1):s("h3",[e._v("Please select a user to start a dialog with")])],1):s("AuthForm")],1):s("div",{staticClass:"page-loader-wrapper"},[e._m(0)]),e._v(" "),e._m(1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"spinner-grow",staticStyle:{width:"5rem",height:"5rem"},attrs:{role:"status"}},[t("span",{staticClass:"sr-only"},[this._v("Loading...")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("audio",{attrs:{visibility:"hidden",id:"notification-audio"}},[t("source",{attrs:{src:"https://notificationsounds.com/soundfiles/2bb232c0b13c774965ef8558f0fbd615/file-jingle-bells-sms.ogg",type:"audio/ogg"}}),this._v(" "),t("source",{attrs:{src:"https://notificationsounds.com/soundfiles/2bb232c0b13c774965ef8558f0fbd615/file-jingle-bells-sms.mp3",type:"audio/mpeg"}})])}]};var O=s("VU/8")(A,k,!1,function(e){s("TJ3I")},null,null).exports;a.a.use(u.a);var N={id:"",name:"",image:"",email:"",updateProfile:void 0,isAuthorizing:!1,error:""},P={setIsAuthorizing:function(e,t){e.isAuthorizing=t},setUserData:function(e,t){var s=t.id,a=t.name,i=t.image,n=t.email,r=t.updateProfile;e.id=s,e.name=a,e.image=i,e.email=n,e.updateProfile=r},resetUserData:function(){N.id="",N.name="",N.image="",N.email="",N.updateProfile=void 0},setError:function(e,t){var s=t.error;e.error=s},resetError:function(e){e.error=""}},j=function(e){var t=e.context,s=e.user,a=e.name,i=s.providerData;t.commit("setUserData",{name:a||i[0].displayName,image:i[0].photoURL,email:i[0].email,id:s.uid,updateProfile:s.updateProfile.bind(s)})},z={namespaced:!0,state:N,mutations:P,actions:{signUpWithEmail:function(e,t){var s=t.email,a=t.password,i=t.name;window.firebase.auth().createUserWithEmailAndPassword(s,a).then(function(e){var t=e.user;return t.updateProfile({displayName:i}).then(function(){return t})}).then(function(e){return g("users/"+e.uid).set({name:i,id:e.uid}).then(function(t){return{responseFromAddNewUser:t,user:e}})}).then(function(t){var s=t.user;j({context:e,user:s,name:i})}).catch(function(t){e.commit("setError",{error:t.message})}).finally(function(){e.commit("setIsAuthorizing",!1)})},signInWithEmail:function(e,t){var s=t.email,a=t.password;window.firebase.auth().signInWithEmailAndPassword(s,a).then(function(t){var s=t.user;j({context:e,user:s})}).catch(function(t){e.commit("setError",{error:t.message})}).finally(function(){e.commit("setIsAuthorizing",!1)})},signOut:function(e){window.firebase.auth().signOut().then(function(){e.commit("resetUserData")}).catch(function(t){e.commit("setError",{error:t.message})})}}};a.a.use(u.a);var W={namespaced:!0,state:{text:"",id:void 0},mutations:{updateFormData:function(e,t){var s=t.text,a=t.id;e.text=s,e.id=a},resetFormData:function(e){e.text="",e.id=""}}},R=s("bOdI"),V=s.n(R);a.a.use(u.a);var $={messages:"",typingUsers:""},B=void 0;function H(e){e.commit("resetDialogsData"),e.commit("updateLoadedStatus",{areLoaded:!1}),$.messages&&$.typingUsers&&(g($.messages).off("child_added"),g($.messages).off("child_changed"),g($.messages).off("child_removed"),g($.typingUsers).off("child_added"),g($.typingUsers).off("child_changed"),$.messages="",$.typingUsers="")}var J={namespaced:!0,state:{selectedDialog:"",messages:{},typingUsers:{},areLoaded:!1},mutations:{updateSelectedDialog:function(e,t){var s=t.selectedDialog;e.selectedDialog=s},updateMessage:function(e,t){var s=t.message;e.messages=d()({},e.messages,V()({},s.key,s.val))},updateTypingUser:function(e,t){var s=t.userId,a=t.isTyping;e.typingUsers=d()({},e.typingUsers,V()({},s,a))},resetDialogsData:function(e){e.selectedDialog="",e.messages={},e.typingUsers={}},updateLoadedStatus:function(e,t){var s=t.areLoaded;e.areLoaded=s}},actions:{loadDialogMessages:function(e,t){var s=t.selectedDialog;H(e),B=Date.now(),e.commit("updateSelectedDialog",{selectedDialog:s}),$.messages="dialogs/"+s+"/messages",$.typingUsers="dialogs/"+s+"/typingUsers",g($.messages).once("value",function(t){t.hasChildren()?(t.forEach(function(t){e.commit("updateMessage",{message:{key:t.key,val:d()({},t.val(),{id:t.key})}})}),setTimeout(function(){var t=document.getElementById("messages");t.scrollTop=t.scrollHeight,e.commit("updateLoadedStatus",{areLoaded:!0})},100)):e.commit("updateLoadedStatus",{areLoaded:!0})}),g($.messages).on("child_added",function(t){var s=t.val();B<s.timestamp&&(e.rootState.auth.id!==s.userId&&document.getElementById("notification-audio").play(),e.commit("updateMessage",{message:{key:t.key,val:d()({},s,{id:t.key})}}))}),g($.messages).on("child_changed",function(t){e.commit("updateMessage",{message:{key:t.key,val:d()({},t.val(),{id:t.key})}})}),g($.messages).on("child_removed",function(t){e.commit("updateMessage",{message:{key:t.key,val:null}})}),g($.typingUsers).on("child_added",function(t){e.commit("updateTypingUser",{userId:t.key,isTyping:t.val()})}),g($.typingUsers).on("child_changed",function(t){e.commit("updateTypingUser",{userId:t.key,isTyping:t.val()})})},saveTypingUser:function(e,t){var s=t.userId,a=t.isTyping;g("dialogs/"+e.state.selectedDialog+"/typingUsers").update(V()({},s,a))},resetDialogs:function(e){H(e)}}};a.a.use(u.a);var Y={namespaced:!0,state:{usersMap:{}},mutations:{saveNewUserInStore:function(e,t){var s=t.user;e.usersMap=d()({},e.usersMap,V()({},s.id,s))}}};a.a.use(u.a);var Z=new u.a.Store({modules:{auth:z,messageForm:W,dialogs:J,users:Y}});i.c.add(n.a),i.c.add(n.c),i.c.add(n.d),i.c.add(n.b),a.a.component("font-awesome-icon",r.a),a.a.config.productionTip=!1,new a.a({el:"#app",components:{App:O},template:"<App/>",store:Z})},TJ3I:function(e,t){},"p5E+":function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.af698c3a7690511fdc73.js.map